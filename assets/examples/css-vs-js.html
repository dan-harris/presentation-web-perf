<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width initial-scale=1 user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta
      name="Description"
      content="danharris.io - portfolio site for Dan Harris - full-stack dev ðŸ¤“, grad advocate ðŸ‘©â€ðŸŽ“, beer enthusiast ðŸº"
    />
    <meta name="theme-color" content="#5e548e" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png" />
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet" />
    <title>danharris.io - web perf</title>
    <style></style>
  </head>
  <body>
    <script src="./fps-counter.js"></script>
    <div class="a" style="transform: none;">CSS</div>
    <div class="b" style="transform: none;">JS</div>
    <div class="status"></div>
    <button class="play" onclick="play()">Play</button>

    <script>
      function play() {
        window.refreshFPS();
        var btn = document.querySelector('.play');
        var a = document.querySelector('.a');
        var b = document.querySelector('.b');
        var status = document.querySelector('.status');

        if (btn.disabled) {
          return;
        }

        btn.disabled = true;
        var start = Date.now();
        var distance = 500;
        var duration = 5000; // 5 seconds

        var animLoop = function() {
          var now = Date.now();
          var curDuration = Math.min(now - start, duration);
          b.style.transform = 'translateX(' + distance * (curDuration / duration) + 'px)';

          if (curDuration === duration) {
            document.body.classList.remove('animate');
            return setTimeout(function() {
              a.style.transform = b.style.transform = 'none';
              status.textContent = '';
              btn.disabled = false;
            }, 500);
          } else {
            requestAnimationFrame(animLoop);
          }
        };

        var heavyJS = function(duration) {
          var start = Date.now();
          var prevText = status.textContent;
          status.textContent = 'run heavy JS calc';
          setTimeout(function() {
            while (true) {
              if (Date.now() - start >= duration) {
                status.textContent = prevText;
                break;
              }
            }
          }, 5);
        };

        // begin animation
        document.body.classList.add('animate');
        a.style.transform = 'translateX(' + distance + 'px)';
        requestAnimationFrame(animLoop);
        // status.textContent = 'animate';

        // block UI thread 2 times
        setTimeout(function() {
          heavyJS(1000);
        }, 1000);

        setTimeout(function() {
          heavyJS(700);
        }, 3500);
      }
    </script>
  </body>
</html>
